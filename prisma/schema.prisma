generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ProjectStatus {
  DRAFT
  PUBLISHED
}

enum Languages {
  JAVASCRIPT
  TYPESCRIPT
  PYTHON
  GO
  JAVA
  CPP
  C
  RUST
  PHP
  RUBY
  SWIFT
  KOTLIN
}

model User {
  id        String    @id @default(cuid())
  name      String?
  email     String    @unique
  password  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  projects  Project[]
}

model Project {
  id          String @id @default(cuid())
  title       String
  slug        String @unique
  description String @db.Text

  // Metadata
  languages Languages[]
  repo_url  String?
  demo_url  String?
  tags      String[]

  // Status flags
  status   ProjectStatus @default(DRAFT)
  featured Boolean       @default(false)

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  publishedAt DateTime?

  // Relations
  author_id String
  author    User      @relation(fields: [author_id], references: [id], onDelete: Cascade)
  sections  Section[]

  @@index([status])
  @@index([slug])
  @@index([author_id])
  @@index([featured])
}

model Section {
  id      String @id @default(cuid())
  title   String
  slug    String
  content String @db.Text // HTML/Markdown content from Tiptap
  order   Int

  // Hierarchical relationship (for nested sections)
  parent_id String?
  parent    Section?  @relation("SectionHierarchy", fields: [parent_id], references: [id], onDelete: Cascade)
  children  Section[] @relation("SectionHierarchy")

  // Metadata
  icon String? // Emoji

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  project_id String
  project    Project @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@unique([project_id, slug])
  @@index([project_id, order])
  @@index([parent_id])
}
